# Resource Metadata

Aurora UIX uses resource metadata to describe your data models and their UI behavior.

## How Metadata is Generated

Resource metadata is automatically generated by parsing the schema module you provide. Aurora UIX inspects the schema's fields and associations, setting default types and options based on the schema definitions. You can override these defaults or add additional options as needed in your resource metadata block.

## Defining Resource Metadata

Use the `auix_resource_metadata/3` macro in your module:

```elixir
defmodule MyAppWeb.ProductViews do
  use Aurora.Uix

  alias MyApp.Inventory
  alias MyApp.Inventory.Product

  auix_resource_metadata :product, context: Inventory, schema: Product do
    field :name, placeholder: "Product name", max_length: 40, required: true
    field :description, max_length: 255
    field :price, precision: 12, scale: 2, readonly: true
  end
end
```

## Field Options

- `placeholder`: Placeholder text for inputs.
- `max_length`: Maximum allowed length.
- `required`: Marks the field as required.
- `readonly`: Field is not editable.
- `precision`, `scale`: For numeric fields.

## Custom Field Types

You can specify field types and custom renderers:

```elixir
field :status, type: :select, options: ["active", "archived"]
field :avatar, type: :image, renderer: &MyAppWeb.Helpers.avatar/1
```

## Associations

Aurora UIX supports two types of associations: **many-to-one** (`belongs_to`) and **one-to-many** (`has_many`). You can configure their behavior in the resource metadata.

### Many-to-One

By default, if a field represents a many-to-one association, it is automatically considered a select html type, and will 
be rendered as such. You can bypass this behaviour by setting the `html_type` option to another type.

The `option_label` option is used **only** for many-to-one associations rendered as select dropdowns. It controls what is shown as the label for each option in the dropdown. By default, the related key (usually an ID) is shown, but you can specify a field (atom), a function, or a function with arity 2 for more advanced labeling.

The `order_by` option is used **only** for many-to-one associations rendered as select dropdowns when the `option_label` option is set to a field.

**Usage:**

- As an atom (field name):
  ```elixir
  field :category_id, html_type: :select, option_label: :name
  ```
  This will use the `:name` field of the related entity as the label in the dropdown.

- As a function (arity 1):
  ```elixir
  field :category_id, html_type: :select, option_label: &MyApp.Category.label/1
  ```
  The function receives the entity and should return a string label.

- As a function (arity 2):
  ```elixir
    def label(assigns, associated) do
      "#{assigns.prefix}_#{associated.code} - #{associated.name}"
    end  
  ```
  ```elixir
  field :category_id, html_type: :select, option_label: &MyApp.Warehouse.label/2
  ```
  The function receives the assigns and each instance of the associated entity, and should return a string label.

**Examples:**

```elixir
# Renders a selector displaying the name contents as the option labels.
# Options are ordered by name.
auix_resource_metadata :product, schema: MyApp.Product do
  field :category_id, html_type: :select, option_label: :name
end
```
```elixir
# Renders a selector displaying the name contents as the option labels.
# Options are ordered by the reference contents (not displayed).
auix_resource_metadata :product, context: Inventory, schema: Product do
  field :category_id, option_label: :name, order_by: [desc: :reference]
end
```

### One-to-Many

Fields representing a **one-to-many** (`has_many`) association are rendered as a list with 
customizable actions for adding, editing, deleting. There are options for sorting and filtering.

These are the available options:
- `:order_by` allows to change the order of how the initial list of elements are rendered.
- `:where` defines filtering.

**Usage:**
```elixir
  auix_create_ui do
    edit_layout :product do
      stacked([
        :reference,
        :name,
        :description
        product_transactions: [order_by: [desc: :quantity], where: {:quantity, :between, 8, 16}]
      ])
    end
  end
```




